<!DOCTYPE html>
<html>
<head>
  <title>The Digital Legal Compass</title>
</head>
<body>
  <h1>The Digital Legal Compass</h1>
  <p>Upload your legal document to get a clear, simple analysis.</p>
  <input type="file" id="docUploader" />
  <button id="submitBtn">Analyze Document</button>
  <hr>
  <h2>Your Analysis:</h2>
  <div id="results">Waiting for document...</div>
  <script>
  const uploader = document.getElementById('docUploader');
  const submitBtn = document.getElementById('submitBtn');
  const resultsDiv = document.getElementById('results');

  // --- CRITICAL: VERIFY THIS URL ONE LAST TIME ---
  // Go to your Cloud Run console, click on your service, and copy the URL from the top.
  const functionUrl = 'https://analyze-legal-document-970352252912.us-central1.run.app'; // NO SLASH AT THE END

  submitBtn.addEventListener('click', async () => {
    const file = uploader.files[0];
    if (!file) {
      alert("Please select a file first!");
      return;
    }

    resultsDiv.innerText = "Analyzing... Please wait. This may take up to a minute.";
    submitBtn.disabled = true;

    const formData = new FormData();
    formData.append('file', file);

    console.log(`Attempting to fetch from: ${functionUrl}`);

    try {
      const response = await fetch(functionUrl, {
        method: 'POST',
        body: formData
        // We don't set Content-Type header when using FormData; the browser does it automatically.
      });

      console.log('Received response from server:', response);

      if (!response.ok) {
        // If the server responded with an error status (like 4xx or 5xx)
        const errorText = await response.text();
        console.error('Server responded with an error:', response.status, errorText);
        resultsDiv.innerText = `An error occurred. Server responded with status ${response.status}. Check the console for more details.`;
      } else {
        // If the server responded with success
        const data = await response.json();
        // We use a library to render Markdown if the response is in that format.
        // For now, we'll just display it as text.
        resultsDiv.innerText = data.analysis;
      }

    } catch (error) {
      console.error('A critical network error occurred:', error);
      resultsDiv.innerText = 'A network error occurred. Please check your connection and the browser console.';
    } finally {
        submitBtn.disabled = false;
    }
  });
</script>

</body>
</html>